# 数据链路层  
---  
## 数据链路层的功能  
数据链路层在物理层提供服务的基础上向网络层提供服务，其主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。  
下面具体介绍数据链路层的功能。  
### 为网络层提供服务  
对网络层而言，数据链路层的基本任务是将源机器中来自网络层的数据传输到目标机器的网络层中。数据链路层为网络层提供如下服务：  
+ 无确认的无连接服务。源机器发送数据帧时不需要先建立链路连接，目的机器收到数据帧时不需发回确认。对丢失的帧，数据链路层不负责重发而交给上层处理。适用于实时通信或误码率较低的通信信道，如以太网。  
+ 有确认的无连接服务。源机器发送数据帧时不需要先建立链路连接，但目的机器收到数据帧时必须发回确认。源机器在所规定的时间内未收到确认信号时，就重传丢失的帧，以提高传输的可靠性。该服务适用于误码率较高的通信信道，如无线通信。  
+ 有确认的面向连接服务。帧传输过程分为三个阶段：建立数据链路、传输帧、释放数据链路。目的机器对收到的每一帧都要给出确认，源机器收到确认后才能发送下一条帧，因而该服务的可靠性最高。该服务适用于通信要求（可靠性、实时性）较高的场合。  

### 链路管理  
数据链路层连接的建立、维持和释放过程称为链路管理，它主要用于面向连接的服务。链路两端的结点要进行通信，必须首先确认对方处于就绪状态，并交换一些必要的信息对帧序号初始化，然后才能建立连接，在传输的过程中则要能维持连接，而在传输完毕后要释放该连接。在多个站点共享同一物理信道的情况下（例如在局域网中）如何在要求的站点间分配和管理信道也属于数据链路层管理的范畴。  

### 帧定界、帧同步与透明传输  
两个工作站之间传输信息时，必须将网络层的分组封装成帧，以帧的格式进行传送。将一段数据的前后添加首部和尾部，就构成了帧。首部和尾部中含有很多控制信息，它们的一个重要作用就是确定帧的界限，即帧定界。而帧同步指的是接收方应能从接收到的二进制比特流中区分出帧的起始和终止。如在HDLC通信规程中，用标识位F(01111110)来标识帧的开始和结束。通信过程中，检测到帧标识F即为帧的开始，然后一旦检测到帧标识位F即表示帧的结束。HDLC标准帧格式如下：  
| 标志 | 地址 | 控制 | 信息 | 帧校验序列 | 标志 |  
| --- | --- | --- | --- | --- | --- | --- |  
| F(01111110) | A 8位 | C 8位 | I N位 | FCS 16位 | F(01111110) |  

如果在数据中恰好出现与帧定界符相同的比特组合（会被误认“传输结束”而丢弃后面的数据），那么就要采用有效的措施解决这个问题，即透明传输。更确切地说，透明传输就是不管所传数据是什么样的比特组合，都应当能在链路上传送。  

### 流量控制  
由于收发双方各自的工作速率和缓存空间的差异，可能出现发送方的发送能力大于接收方的接受能力的现象，如若此时不适当限制发送方的发送速率（即链路上信息流量），前面来不及接收的帧将会被后面不断发送来的帧“淹没”，造成帧的丢失而出错。因此，流量控制实际上就是限制发送方的数据流量，使其发送速率不超过接收方的接收能力。  
这个过程需要通过某种反馈机制使发送方知道接收方能否跟得上自己，即需要有一些规则使得发送方知道在什么情况下可以接着发送下一帧，而在什么情况下必须暂停发送，以等待收到某种反馈信号后继续发送。  
流量控制并不是数据链路层特有的功能，许多高层协议中也提供此功能，只不过控制的对象不同而已。对于数据链路层来说，控制的是相邻两结点之间的数据链路上的流量，而对于运输层来说，控制的则是从源端到目的端之间的流量。  

### 差错控制  
由于信道噪声等各种原因，帧在传输过程中可能会出现错误。用以**使发送方确定接收方是否正确收到由其发送的数据的方法称为差错控制**。通常，这些错误可分为位错和帧错。  
位错指帧中某些位出现了差错。通常采用循环冗余校验（CRC）方式发现位错，通过自动重传请求（Automatic Repeat reQuest,ARQ）方式来重传出错的帧。具体做法是：让发送方将要发送的数据帧附加一定的CRC冗余校验码一并发送，接收方则根据检错码对数据帧进行错误检测，若发现错误则丢弃，发送方超时重传该数据帧。这种差错控制方法称为ARQ法。ARQ法只需返回很少的控制信息就可有效地确认所发数据帧是否被正确接收。  
帧错误指帧的丢失、重复或失序等错误。在数据链路层引入定时器和编码机制，以保证每一帧最终都能有且仅有一次正确地交付给目的结点。  